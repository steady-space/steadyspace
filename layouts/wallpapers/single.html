{{ define "main" }}

{{/* HERO order: cover.image ‚Üí hero ‚Üí thumb */}}
{{ $hero := "" }}
{{ with .Params.cover.image }}{{ $hero = . }}{{ end }}
{{ if eq $hero "" }}{{ with .Params.hero  }}{{ $hero = . }}{{ end }}{{ end }}
{{ if eq $hero "" }}{{ with .Params.thumb }}{{ $hero = . }}{{ end }}{{ end }}

{{/* mark if the chosen hero is the thumb (for smaller styling) */}}
{{ $isThumb := false }}
{{ if and (ne $hero "") (eq $hero .Params.thumb) }}
  {{ $isThumb = true }}
{{ end }}

{{/* ---------- ACCENT: params.accent OR hex[accent_index] (default 2) ---------- */}}
{{ $accent := .Params.accent }}
{{ if not $accent }}
  {{ $idx := .Params.accent_index | default 2 }}
  {{ with .Params.hex }}
    {{ if ge (len .) (add $idx 1) }}
      {{ $accent = index . $idx }}
    {{ else }}
      {{ $accent = "#1e3a8a" }}
    {{ end }}
  {{ else }}
    {{ $accent = "#1e3a8a" }}
  {{ end }}
{{ end }}

<article class="wp-single" style="--accent: {{ $accent }};">
  
  <!-- TITLE + HERO -->
<header class="wp-head">
  <h1>{{ .Title }}</h1>
  {{ if $hero }}
    <img class="wp-hero{{ if $isThumb }} is-thumb{{ end }}" src="{{ $hero }}" alt="{{ .Title }}" loading="lazy" />
  {{ end }}
  {{ with .Params.oneliner }}<p class="wp-oneliner">‚Äú{{ . }}‚Äù</p>{{ end }}
</header>

{{/* --- MINI GALLERY under the hero: Thumb + (optional) Reversed --- */}}
{{ $items := slice }}

{{ with .Params.thumb }}
  {{ $items = $items | append (dict "src" . "label" "Thumb") }}
{{ end }}

{{/* Resolve $rev from several possible keys (string or table) */}}
{{ $rev := "" }}
{{ with .Params.cover }}
  {{ with .reversed }}
    {{ $val := . }}
    {{ if and (ne (printf "%T" $val) "string") (isset $val "image") }}
      {{ $rev = $val.image }}     {{/* table form: [cover.reversed] image="..." */}}
    {{ else }}
      {{ $rev = $val }}           {{/* string form */}}
    {{ end }}
  {{ end }}
{{ end }}
{{ if and (eq $rev "") (isset .Params "cover_rev") (ne .Params.cover_rev "") }}
  {{ $rev = .Params.cover_rev }}
{{ else if and (eq $rev "") (isset .Params "reverse") (ne .Params.reverse "") }}
  {{ $rev = .Params.reverse }}
{{ else if and (eq $rev "") (isset .Params "mockups") (isset .Params.mockups "reverse") (ne .Params.mockups.reverse "") }}
  {{ $rev = .Params.mockups.reverse }}
{{ end }}

{{/* Only append Reversed if source exists (or is external) */}}
{{ with $rev }}
  {{ $src := . }}
  {{ $ok := false }}
  {{ if hasPrefix $src "http" }}
    {{ $ok = true }}
  {{ else }}
    {{ $rel := replaceRE "^/" "" $src }}               {{/* "images/‚Ä¶png" */}}
    {{ $staticPath := printf "static/%s" $rel }}        {{/* "static/images/‚Ä¶png" */}}
    {{ $assetsPath := printf "assets/%s" $rel }}        {{/* "assets/images/‚Ä¶png" */}}
    {{ if or (fileExists $staticPath) (fileExists $assetsPath) (fileExists $rel) }}
      {{ $ok = true }}
    {{ end }}
  {{ end }}
  {{ if $ok }}
    {{ $items = $items | append (dict "src" $src "label" "Reversed") }}
  {{ end }}
{{ end }}

{{ if gt (len $items) 0 }}
<section class="wp-film">
  <div class="film-row {{ if eq (len $items) 1 }}single{{ end }}">
    {{ range $items }}
      <figure class="film-tile">
        <img src="{{ .src }}" alt="{{ $.Title }} ‚Äî {{ .label }}" loading="lazy" />
        <figcaption>{{ .label }}</figcaption>
      </figure>
    {{ end }}
  </div>
</section>
{{ end }}

  <!-- YOUR CONTENT (you add boxes/haiku/palette in Markdown) -->
  <section class="wp-intro">
    {{ .Content }}
  </section>

<!-- WHAT'S INSIDE -->
<section class="wp-box">
  <h3>üìÇ What‚Äôs Inside</h3>
  <ul class="wp-list">
    <li>A refined wallpaper design in <strong>13 sizes</strong> for desktop, mobile, and tablet ‚Äî optimized for the latest iPhones, iPads, Android devices, and 4K desktops:</li>

    <li class="wp-section">üñ• <strong>Desktop</strong>
      <ul class="wp-sublist">
        <li>3840√ó2160 (4K)</li>
        <li>3072√ó1920 (MacBook Pro)</li>
        <li>2560√ó1440 (QHD)</li>
        <li>1920√ó1080 (FullHD)</li>
      </ul>
    </li>

    <li class="wp-section">üì± <strong>Mobile</strong>
      <ul class="wp-sublist">
        <li>1080√ó1920 (Universal)</li>
        <li>1170√ó2532 (iPhone Pro + earlier)</li>
        <li>1290√ó2796 (iPhone Pro Max + earlier)</li>
        <li>1260√ó2736 (iPhone Air)</li>
        <li>1206√ó2622 (iPhone 17 Pro + newer)</li>
        <li>1320√ó2868 (iPhone 17 Pro Max + newer)</li>
        <li>1440√ó3200 (Android)</li>
      </ul>
    </li>

    <li class="wp-section">üì± <strong>Tablet</strong>
      <ul class="wp-sublist">
        <li>2048√ó2732 (iPad Pro)</li>
        <li>1536√ó2048 (iPad Mini/standard)</li>
      </ul>
    </li>

    <li>üìÑ A polished <strong>README (PDF + TXT)</strong> with color palette, included sizes, and setup tips</li>
    <li>üîÑ Both the original gradient orientation and a <em>bonus reversed version</em> so you can choose whichever feels best for your screen or icon layout</li>
    <li>üíß All wallpapers are logo & watermark-free</li>
  </ul>
</section>

  <!-- Fixed: HOW TO USE -->
  <section class="wp-box">
    <h3>ü™Ñ How to Use</h3>
    <ol class="wp-steps">
      <li>Open your device‚Äôs folder.</li>
      <li>Pick the resolution that matches your screen.</li>
      <li>Set as wallpaper.</li>
      <li>‚ú® Breathe. Let your setup feel a little more steady.</li>
    </ol>
  </section>

<!-- CTA -->
<section class="wp-cta">
  {{/* Read links from root or nested [cover] fallback */}}
  {{ $payhip  := "" }}
  {{ $gumroad := "" }}

  {{ with .Params.payhip }}  {{ $payhip = . }}  {{ end }}
  {{ if and (eq $payhip "") (isset .Params "cover") (isset .Params.cover "payhip") }}
    {{ $payhip = .Params.cover.payhip }}
  {{ end }}

  {{ with .Params.gumroad }} {{ $gumroad = . }} {{ end }}
  {{ if and (eq $gumroad "") (isset .Params "cover") (isset .Params.cover "gumroad") }}
    {{ $gumroad = .Params.cover.gumroad }}
  {{ end }}

  {{ $hasPayhip  := ne (trim $payhip  " ") "" }}
  {{ $hasGumroad := ne (trim $gumroad " ") "" }}

  {{ if or $hasPayhip $hasGumroad }}
    <div class="cta-row">
      {{ if $hasPayhip }}
        <a class="wp-btn wp-btn--primary"
           href="{{ $payhip }}"
           target="_blank" rel="noopener">
          Buy on Payhip
        </a>
      {{ end }}

      {{ if and $hasPayhip $hasGumroad }}
        <span class="cta-sep">‚ú¶</span>
      {{ end }}

      {{ if $hasGumroad }}
        <a class="wp-btn wp-btn--ghost"
           href="{{ $gumroad }}"
           target="_blank" rel="noopener">
          Buy on Gumroad
        </a>
      {{ end }}
    </div>

    {{ $price := printf "%.2f" (float (.Params.price | default 2.50)) }}
    {{ $isPWYW := eq (.Params.pricing_model | default "pwyw") "pwyw" }}

    <p class="wp-price">
      ${{ $price }}{{ if $isPWYW }}+{{ end }} ¬∑ Instant download ¬∑ Personal use only
    </p>
  {{ else }}
    <p class="wp-price">Available soon.</p>
  {{ end }}
</section>

</article>

<style>
/* --- Page rhythm & base type --- */
.wp-single{
  max-width:860px;
  margin:0 auto;
  padding:2rem 1rem 4rem;
  color:#333;
  line-height:1.65;
  font-size:15.5px;
}
.wp-head h1{
  font-size:clamp(1.45rem,2.1vw,1.9rem);
  text-align:center;
  margin-bottom:.35rem;
}

/* Hero size: wide covers are large but bounded; thumbs are smaller */
.wp-hero{
  display:block;
  width:min(920px, 100%);
  max-height:70vh;
  height:auto;
  margin:.75rem auto 1rem;
  border-radius:12px;
  box-shadow:0 8px 24px rgba(0,0,0,.05);
  object-fit:cover;
}
.wp-hero.is-thumb{
  width:min(680px, 92%);   /* smaller if we had to use the square thumb */
  border-radius:14px;
}

/* ===========================
   UNIFIED WHITE ‚ÄúSLAB‚Äù BOXES
   (shared shell for all slabs)
   =========================== */
.wp-oneliner,
.wp-haiku,
.wp-desc,
.wp-box{
  position: relative;
  width: 100%;
  margin: 1rem 0;
  padding: .9rem 1.1rem .95rem 1.25rem;
  background: #fff;
  border: 1px solid #eee;
  border-radius: 14px;
  box-shadow: 0 6px 16px rgba(0,0,0,.03);
  border-left: 4px solid var(--accent, #1e3a8a);
}
@supports (color: color-mix(in srgb, white, black)) {
  .wp-oneliner, .wp-haiku, .wp-desc, .wp-box{
    border-left-color: color-mix(in srgb, var(--accent, #1e3a8a) 70%, white 30%);
  }
}

/* Center + tighten the three small slabs only (keep .wp-box full width) */
.wp-oneliner,
.wp-haiku,
.wp-desc{
  max-width: 720px;       /* same visual width for the trio */
  margin: 1rem auto;      /* center them */
  color: #333;
}

/* One-liner */
.wp-oneliner{
  text-align: center;
  font-style: italic;
  padding: .85rem 1rem .95rem;
  margin-top: .5rem;
}

/* Description */
.wp-desc{
  line-height: 1.65;
  padding: 1rem 1.25rem;
}

/* Haiku */
.wp-haiku{
  text-align: center;
  font-style: italic;
  padding: 1rem 1.25rem 1.1rem;
}
.wp-haiku p{ margin: 0; line-height: 1.6; white-space: pre-line; }

/* Section headings inside .wp-box */
.wp-box h3{ margin:.15rem 0 .55rem; font-size:1.15rem; }

/* ===========================
   CLEAN, CONSISTENT BULLETS
   (scoped to .wp-box only)
   =========================== */

/* Parent list: solid disc bullets */
.wp-box .wp-list{
  list-style: disc;
  margin: .6rem 0 .9rem;
  padding-left: 1.9rem;   /* comfy inset from box edge */
}

/* Remove any legacy custom bullets you might still have */
.wp-box .wp-list > li::before{ content: none !important; }

.wp-box .wp-list > li{
  margin:.55rem 0;
}

/* Desktop / Mobile / Tablet labels: same-size hollow circles */
.wp-box .wp-list > li.wp-section{
  list-style: circle;     /* native hollow circle */
  margin-left:2rem;     /* tiny visual nudge */
}

/* Resolution sublist: no bullets, arrow pointer */
.wp-box .wp-sublist{
  list-style: none;
  margin:.35rem 0 .25rem;
  padding-left: 2rem;     /* deeper indent under section label */
}
.wp-box .wp-sublist li{
  position:relative;
  margin:.28rem 0;
  padding-left:1.05rem;
}
.wp-box .wp-sublist li::before{
  content:"‚Ü≥";
  position:absolute;
  left:0;
  top:0;
  font-size:.95em;
  color: color-mix(in srgb, var(--accent, #1e3a8a) 80%, #000 20%);
  opacity:.9;
  line-height:1.25;
}

/* ‚ÄúHow to Use‚Äù ‚Äî real ordered list kept intact */
.wp-box .wp-steps{
  list-style: decimal;
  margin:.25rem 0 .25rem 0;
  padding-left:1.9rem;    /* align with parent bullets */
}
.wp-box .wp-steps li{
  margin:.35rem 0;
}
.wp-box .wp-steps li::before{ content:none; }

/* --- Unified Story Slab (one-liner + desc + haiku) --- */
.wp-story {
  background:#fff;
  border:1px solid #eee;
  border-left:4px solid var(--accent,#1e3a8a);
  border-radius:14px;
  box-shadow:0 6px 16px rgba(0,0,0,.03);
  padding:1.2rem 1.4rem 1.4rem;
  margin:1rem auto;
  max-width:720px;
  color:#333;
  line-height:1.65;
}

/* soften the accent tone to match other boxes */
@supports (color: color-mix(in srgb, white, black)) {
  .wp-story {
    border-left-color: color-mix(in srgb, var(--accent,#1e3a8a) 70%, white 30%);
  }
}

.wp-story .tagline {
  text-align:center;
  font-style:none;
  margin-bottom:.9rem;
  color:#333;
}

/* refined haiku ‚Äî tight rhythm + no divider */
.wp-story .haiku {
  text-align:left;
  font-style:none;
  margin-top:1rem;
  line-height:1.35;       /* tighter line height */
  color:#666;
  white-space:normal;     /* prevents double-spacing */
}

/* remove divider entirely (optional: comment back in if desired) */
.wp-story .haiku::before { display:none; }

/* ===========================
   Palette Chips ‚Äî Accent-Aware
   =========================== */
.wp-palette {
  display: flex;
  justify-content: center;
  gap: .4rem;
  flex-wrap: wrap;
  margin: .8rem 0 0;
}

.wp-chip {
  --c: #ccc;
  width: 22px;
  height: 22px;
  border-radius: 6px;
  background: var(--c);
  box-shadow:
    inset 0 0 0 1px rgba(0, 0, 0, .08),
    0 0 0 0 color-mix(in srgb, var(--accent, #1e3a8a) 0%, transparent);
  transition:
    transform .15s ease,
    box-shadow .25s ease,
    filter .25s ease;
}

/* smooth hover pop ‚Äî feels tactile */
.wp-chip:hover {
  transform: scale(1.12);
  box-shadow:
    inset 0 0 0 1px rgba(0,0,0,.1),
    0 0 10px color-mix(in srgb, var(--accent, #1e3a8a) 40%, transparent);
  filter: brightness(1.05);
}

/* optional: add subtle outline when chip matches accent tone closely */
@supports (color: color-mix(in srgb, white, black)) {
  .wp-chip {
    box-shadow:
      inset 0 0 0 1px color-mix(in srgb, var(--c) 80%, black 10%),
      0 0 0 0 color-mix(in srgb, var(--accent, #1e3a8a) 0%, transparent);
  }
}

/* ===========================
   CTA (Buy Buttons ‚Äî Adaptive Glow)
   =========================== */
.wp-cta {
  text-align: center;
  margin: 2rem auto 0;
  padding: 1rem 0 0.5rem;
}

.wp-cta .cta-row {
  display: flex;
  justify-content: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}

/* Core button */
.wp-btn {
  --btn-accent: var(--accent, #1e3a8a);
  display: inline-block;
  border-radius: 9999px;
  padding: 0.68rem 1.4rem;
  font-weight: 600;
  text-decoration: none;
  line-height: 1;
  font-size: 0.95rem;
  transition:
    transform 0.15s ease,
    box-shadow 0.25s ease,
    background-color 0.25s ease,
    color 0.25s ease,
    border-color 0.25s ease;
}
.wp-btn:hover {
  transform: translateY(-2px);
}

.cta-row {
  display: flex;
  justify-content: center;
  align-items: center; /* ensures ‚ú¶ stays vertically centered */
  gap: 0.75rem;
  flex-wrap: wrap;
}

.cta-sep {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: color-mix(in srgb, var(--accent, #1e3a8a) 70%, #555 30%);
  font-size: 1rem;
  padding: 0 .4rem;
  line-height: 1;
  opacity: .75;
  user-select: none;
  text-shadow: 0 0 5px color-mix(in srgb, var(--accent, #1e3a8a) 20%, transparent);
}

/* Primary (Payhip) ‚Äî adaptive fill + glow */
.wp-btn--primary {
  background: var(--btn-accent);
  color: #fff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.wp-btn--primary:hover {
  background: color-mix(in srgb, var(--btn-accent) 85%, white 15%);
  box-shadow:
    0 0 18px color-mix(in srgb, var(--btn-accent) 60%, transparent),
    0 4px 20px rgba(0, 0, 0, 0.1);
}

/* Ghost (Gumroad) ‚Äî adaptive outline + glow */
.wp-btn--ghost {
  background: #fff;
  color: var(--btn-accent);
  border: 2px solid color-mix(in srgb, var(--btn-accent) 75%, white 25%);
}
.wp-btn--ghost:hover {
  background: color-mix(in srgb, var(--btn-accent) 10%, white 90%);
  border-color: color-mix(in srgb, var(--btn-accent) 90%, white 10%);
  box-shadow:
    0 0 16px color-mix(in srgb, var(--btn-accent) 35%, transparent);
}

/* Meta line */
.wp-price {
  margin: 0.75rem 0 0;
  font-size: 0.92rem;
  color: #666;
}

/* --- Mockup mini gallery (no links, no crop) --- */
.wp-gallery{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:1rem;
  margin:1rem 0 1.5rem;
}

.wp-g{
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  background:#fff;
  border:1px solid #e8e8e8;
  border-radius:14px;
  padding:.6rem;
  box-shadow:0 4px 12px rgba(0,0,0,.04);
  transition:transform .18s ease, box-shadow .18s ease;
}

.wp-g:hover{
  transform:translateY(-3px);
  box-shadow:0 6px 16px rgba(0,0,0,.06);
}

.wp-g img{
  display:block;
  width:clamp(170px, 26vw, 240px);
  height:clamp(170px, 26vw, 240px);
  /* keep the whole image visible inside a square ‚Äúmat‚Äù */
  object-fit:contain;
  background:#fff;
  border-radius:10px;
  box-shadow:inset 0 0 0 1px rgba(0,0,0,.06);
  margin-bottom:.4rem;
}

.wp-gcap{
  font-size:.8rem;
  color:#667;
}

/* --- Film strip (Thumb + Reversed) ‚Äî accent-aware --- */
.wp-film{
  margin:1.25rem 0 1.75rem;
  max-width:880px;
  margin-inline:auto;
}
.film-row{
  display:flex;
  gap:1rem;
  justify-content:center;
  flex-wrap:wrap;
}
.film-row.single{ justify-content:center; } /* when only 1 tile */

/* Tile shell picks up --accent */
.film-tile{
  flex:0 1 320px;
  background:#fff;
  border:1px solid color-mix(in srgb, var(--accent, #1e3a8a) 18%, #eaeaea 82%);
  border-left:2px solid color-mix(in srgb, var(--accent, #1e3a8a) 75%, white 25%);
  border-radius:14px;
  box-shadow:0 4px 14px rgba(0,0,0,.04);
  padding:.7rem;
  display:flex;
  flex-direction:column;
  align-items:center;
  transition:transform .15s ease, box-shadow .2s ease, border-color .2s ease;
}
.film-tile:hover{
  transform:translateY(-2px);
  box-shadow:
    0 0 18px color-mix(in srgb, var(--accent, #1e3a8a) 28%, transparent),
    0 6px 18px rgba(0,0,0,.08);
  border-color: color-mix(in srgb, var(--accent, #1e3a8a) 28%, #eaeaea 72%);
}

/* Image sits on a subtle ‚Äúmat‚Äù */
.film-tile img{
  display:block;
  width:100%;
  height:200px;            /* uniform tile height */
  object-fit:contain;      /* never crop */
  background:#fff;
  border-radius:10px;
  box-shadow:inset 0 0 0 0px rgba(0,0,0,.06);
  border:none;
}

/* Caption picks up a softer accent */
.film-tile figcaption{
  font-size:.8rem;
  color: color-mix(in srgb, var(--accent, #1e3a8a) 55%, #3a3a3a 45%);
  margin-top:.45rem;
}

/* Slightly smaller hero to give breathing room above gallery */
.wp-hero{ max-width:820px; }
</style>

{{ end }}
